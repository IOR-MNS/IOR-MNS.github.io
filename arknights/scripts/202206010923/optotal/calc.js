var itemOrder=[["\ucee8\ub514\uc158","\ub4dc\ub860"],["\uacbd\ud5d8\uce58","\uc6a9\ubb38\ud3d0"],["\uace0\uae09\uc99d\uba85\uc11c","\uad6c\ub9e4\uc99d\uba85\uc11c","\uc790\uaca9\uc99d\uba85\uc11c"],["\uc6a9\uace8","\uac00\uad6c \ubd80\ud488"],"\uace0\uae09\uac74\uc124\uc790\uc7ac;\uc911\uae09\uac74\uc124\uc790\uc7ac;\ucd08\uae09\uac74\uc124\uc790\uc7ac;\uce74\ubcf8 \ud329;\uce74\ubcf8 \ubc88\ub4e4;\uce74\ubcf8".split(";"),["\uace0\uae09\uc791\uc804\uae30\ub85d","\uc911\uae09\uc791\uc804\uae30\ub85d",
"\ucd08\uae09\uc791\uc804\uae30\ub85d","\uae30\ucd08\uc791\uc804\uae30\ub85d"],["\uc2a4\ud0ac\uac1c\ub860 \uc81c3\uad8c","\uc2a4\ud0ac\uac1c\ub860 \uc81c2\uad8c","\uc2a4\ud0ac\uac1c\ub860 \uc81c1\uad8c"],"\uce69 \ucca8\uac00\uc81c;\ubc45\uac00\ub4dc \ub4c0\uc5bc \uce69;\uac00\ub4dc \ub4c0\uc5bc \uce69;\ub514\ud39c\ub354 \ub4c0\uc5bc \uce69;\uc2a4\ub098\uc774\ud37c \ub4c0\uc5bc \uce69;\uce90\uc2a4\ud130 \ub4c0\uc5bc \uce69;\uba54\ub515 \ub4c0\uc5bc \uce69;\uc11c\ud3ec\ud130 \ub4c0\uc5bc \uce69;\uc2a4\ud398\uc15c\ub9ac\uc2a4\ud2b8 \ub4c0\uc5bc \uce69;\ubc45\uac00\ub4dc \uce69\uc14b;\uac00\ub4dc \uce69\uc14b;\ub514\ud39c\ub354 \uce69\uc14b;\uc2a4\ub098\uc774\ud37c \uce69\uc14b;\uce90\uc2a4\ud130 \uce69\uc14b;\uba54\ub515 \uce69\uc14b;\uc11c\ud3ec\ud130 \uce69\uc14b;\uc2a4\ud398\uc15c\ub9ac\uc2a4\ud2b8 \uce69\uc14b;\ubc45\uac00\ub4dc \uce69;\uac00\ub4dc \uce69;\ub514\ud39c\ub354 \uce69;\uc2a4\ub098\uc774\ud37c \uce69;\uce90\uc2a4\ud130 \uce69;\uba54\ub515 \uce69;\uc11c\ud3ec\ud130 \uce69;\uc2a4\ud398\uc15c\ub9ac\uc2a4\ud2b8 \uce69".split(";"),
["\ubaa8\ub4c8 \ub370\uc774\ud130 \ube14\ub85d","D32\uac15","\ubc14\uc774\ud3f4\ub77c \ub098\ub178\ud50c\ub808\uc774\ud06c \uce69","\uc911\ud569\uc81c","\uacb0\uc815 \uc804\uc790 \uc7a5\uce58"],"RMA70-24;\ub9dd\uac04 \uc911\ud569\uccb4;\ud654\uc774\ud2b8 \ud638\uc2a4 \ucf5c;\uace0\uae09 \uc5f0\ub9c8\uc11d;\uc911\ud569\uc824;\uc5f4\ud569\uae08 \ud329;\uacb0\uc815 \ud68c\ub85c;\uc815\uc81c\ub41c \uc6a9\uc81c;\uc808\uc0ad\uc6d0\uc561;RMA70-12;\ub9dd\uac04 \uad11\uc11d;\ub85c\uc2dd \ucf5c;\uc5f0\ub9c8\uc11d;\uc824;\uc5f4\ud569\uae08;\uacb0\uc815 \ubd80\ud488;\ubc18\uc790\uc5f0 \uc6a9\uc81c;\ud654\ud569\uc808\uc0ad\uc561".split(";"),
"\ud3ec\ub3c4\ub2f9 \ud329;\ud3f4\ub9ac\uc5d0\uc2a4\ud14c\ub974 \ud329;\uac1c\ub7c9 \uc7a5\uce58;\uc815\uc81c \uc6d0\uc554;\uc544\ucf00\ud1a4 \ud329;\uc774\ucca0 \ud329;\ud3ec\ub3c4\ub2f9 \ubc88\ub4e4;\ud3f4\ub9ac\uc5d0\uc2a4\ud14c\ub974 \ubc88\ub4e4;\ub9ac\ub274\uc5bc \uc7a5\uce58;\uc6d0\uc554 \ud050\ube0c \ubc88\ub4e4;\uc544\ucf00\ud1a4 \uc751\uc9d1\uccb4 \ubc88\ub4e4;\uc774\ucca0 \ubc88\ub4e4;\ud3ec\ub3c4\ub2f9;\ud3f4\ub9ac\uc5d0\uc2a4\ud14c\ub974;\uc7a5\uce58;\uc6d0\uc554 \ud050\ube0c;\uc544\ucf00\ud1a4 \uc751\uc9d1\uccb4;\uc774\ucca0;\ub300\uccb4\ub2f9;\uc5d0\uc2a4\ud14c\ub974 \uc6d0\ub8cc;\ud30c\uc190\ub41c \uc7a5\uce58;\uc6d0\uc554;\ub514\ucf00\ud1a4;\uc774\ucca0 \uc870\uac01".split(";")];
const getGroupIdx=function(b){for(var a=db.item[b].name.kr,e=0;e<itemOrder.length;++e)if(0<=itemOrder[e].indexOf(a))return e;console.log("\uc5d0\ub7ec: \uadf8\ub8f9 \uc778\ub371\uc2a4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c: ",a,b);return-1},showDetailedResult=function(){$("#result-container #detailed-result").css("display","block");$("#result-container .show-detailed-result").css("display","none");$("#result-container .hide-detailed-result").css("display","inline-block")},hideDetailedResult=function(){$("#result-container #detailed-result").css("display",
"none");$("#result-container .show-detailed-result").css("display","inline-block");$("#result-container .hide-detailed-result").css("display","none")},toImg=function(b,a,e=!1){var d=getItemIDByKRName(b),g=' class="result-item-container',c="";0<=d&&(0<db.item[d].craft.length&&(g+=" clickable"),c+=' name="item_'+d+'"');d="<div"+(g+'"')+c+'><img src="./images/item/t/'+(b+'.png" alt="'+b+'"><div class="result-item-quantity');e?d+=" small":"\uc6a9\ubb38\ud3d0"===b&&(d+=" small");d+='">';d+=decimalComma(String(a));
d+="</div>";d+='<span class="result-item-name">';d+=b;d+="</span>";return d+="</div> "},makeResultHtml=function(b){for(var a="",e=0;e<b.IDs.length;++e){var d=b.IDs[e];a+=toImg(db.item[d].name.kr,b[d])}return a},makeResultHtmlByGroup=function(b){for(var a=' <div class="result-group">',e=-1,d=0;d<b.IDs.length;++d){var g=b.IDs[d],c=getGroupIdx(g);-1==c&&console.log("\uc5d0\ub7ec: \uadf8\ub8f9 \uc778\ub371\uc2a4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c: ",db.item[g].name.kr,g);0<d&&e!=c&&(a+='</div> <br><br> <div class="result-group">');
a+=toImg(db.item[g].name.kr,b[g]);e=c}return a+"</div> "},getItemIDByKRName=function(b){for(var a=0,e=db.item.keys.length,d;a<e;++a)if(d=db.item.keys[a],db.item[d].name.kr===b)return a;return-1};var decimalComma=function(b){b=b.toString();var a=b.length%3;var e=0<a?[b.slice(0,a)]:[];for(var d=b.length;a<d;a+=3)e.push(b.slice(a,a+3));return e.join(",")};
const recalcExpLmd=function(){var b=calc(fetchInputData());localStorage.setItem("optotal_exp-stage",document.getElementById("exp-stage").value);localStorage.setItem("optotal_lmd-stage",document.getElementById("lmd-stage").value);var a=localStorage.getItem("optotal_exp-stage"),e=localStorage.getItem("optotal_lmd-stage");a in db.oplv.stage.exp||(a="LS-5");e in db.oplv.stage.lmd||(e="CE-5");var d=db.oplv.stage.exp[a].sanity,g=db.oplv.stage.exp[a].reward;a=Math.ceil(b.total.exp/g.lowerBound);g=Math.ceil(b.total.exp/
g.upperBound);var c=db.oplv.stage.lmd[e].sanity,l=db.oplv.stage.lmd[e].reward;e=Math.ceil(b.total.lmd/l.lowerBound);b=Math.ceil(b.total.lmd/l.upperBound);l=a*d+e*c;d=g*d+b*c;c=decimalComma(g);g!=a&&(c+=" - "+decimalComma(a));c+="\ud68c \ud074\ub9ac\uc5b4";document.getElementById("exp-num").innerText=c;c=decimalComma(b);b!=e&&(c+=" - "+decimalComma(e));c+="\ud68c \ud074\ub9ac\uc5b4";document.getElementById("lmd-num").innerText=c;c=decimalComma(d);d!=l&&(c+=" - "+decimalComma(l));c+="\uc774\uc131 \uc18c\ubaa8";
document.getElementById("sanity-usage").innerText=c},tt=function(b){var a='<hr class="main-line"><span class="result-maintitle">\ud569\uacc4</span><br><hr class="sub-line"><span class="result-subtitle">\uacbd\ud5d8\uce58, \uc6a9\ubb38\ud3d0</span><hr> <div style="margin-top: 2px; display: inline-block; border: none; width: 100%; text-align: center">'+toImg("\uacbd\ud5d8\uce58",b.total.exp,!0);a+=toImg("\uc6a9\ubb38\ud3d0",b.total.lmd,!0);a+='</div><br><div style="margin-top: 8px; margin-bottom: 8px; width: 100%; font-size: 10px; text-align: center">\u25bc</div>';
let e=localStorage.getItem("optotal_exp-stage"),d=localStorage.getItem("optotal_lmd-stage");e in db.oplv.stage.exp||(e="LS-5");d in db.oplv.stage.lmd||(d="CE-5");var g=db.oplv.stage.exp[e].sanity,c=db.oplv.stage.exp[e].reward,l=Math.ceil(b.total.exp/c.lowerBound);c=Math.ceil(b.total.exp/c.upperBound);var m=db.oplv.stage.lmd[d].sanity,h=db.oplv.stage.lmd[d].reward,k=Math.ceil(b.total.lmd/h.lowerBound);h=Math.ceil(b.total.lmd/h.upperBound);var f=l*g+k*m;g=c*g+h*m;a+=' <div class="result-exp-lmd-container"><div class="result-exp-lmd"><span style="color: #777; font-size: 15px">\uacbd\ud5d8\uce58</span><select id="exp-stage" onchange="recalcExpLmd()">';
for(let n in db.oplv.stage.exp)a+=`<option value="${n}"`,n==e&&(a+=" selected"),a+=`>${n}</option>`;a=a+'</select> \u25b8 <span id="exp-num" class="tag stage-guide-item">'+decimalComma(c);c!=l&&(a+=" - "+decimalComma(l));a+='\ud68c \ud074\ub9ac\uc5b4</span></span><br><span style="color: #777; font-size: 15px">\uc6a9\ubb38\ud3d0</span><select id="lmd-stage" onchange="recalcExpLmd()">';for(let n in db.oplv.stage.lmd)a+=`<option value=${n}`,n==d&&(a+=" selected"),a+=`>${n}</option>`;a=a+'</select> \u25b8 <span id="lmd-num" class="tag stage-guide-item">'+
decimalComma(h);h!=k&&(a+=" - "+decimalComma(k));a=a+'\ud68c \ud074\ub9ac\uc5b4</span></span><br><span style="color: #777; font-size: 15px">\uacbd\ud5d8\uce58+\uc6a9\ubb38\ud3d0</span> \u25b8 <span id="sanity-usage" class="tag stage-guide-item">'+decimalComma(g);g!=f&&(a+=" - "+decimalComma(f));a=a+'\uc774\uc131 \uc18c\ubaa8</span></span><br></div></div> <br><br><hr class="sub-line"><span class="result-subtitle">\ubaa8\ub4e0 \uc7ac\ub8cc \ud569\uc0b0</span><hr>'+makeResultHtmlByGroup(b.total);a=a+
'<hr><button type="button" class="show-detailed-result" onclick="showDetailedResult()">\uc138\ubd80 \uacb0\uacfc \ubcf4\uc774\uae30</button><button type="button" class="hide-detailed-result" onclick="hideDetailedResult()" style="display: none">\uc138\ubd80 \uacb0\uacfc \uc228\uae30\uae30</button><div id="detailed-result" style="display:none"><hr class="sub-line"><span class="result-subtitle">\ub808\ubca8\ub9c1 \ube44\uc6a9<br>(\uc815\uc608\ud654 \ube44\uc6a9 \uc81c\uc678)</span><hr> <div class="result-group">'+
toImg("\uacbd\ud5d8\uce58",b.total.exp,!0);a+=toImg("\uc6a9\ubb38\ud3d0",b.opLeveling.lmd,!0);a=a+'</div> <hr><hr class="sub-line"><span class="result-subtitle">\uc815\uc608\ud654 \uc7ac\ub8cc</span><hr>'+makeResultHtmlByGroup(b.elitePromotion);a=a+'<hr><hr class="sub-line"><span class="result-subtitle">\uc2a4\ud0ac \uac15\ud654 \uc7ac\ub8cc</span><hr>'+makeResultHtmlByGroup(b.skillLeveling);a=a+'<hr><hr class="sub-line"><span class="result-subtitle">\uac15\ud654 \ubaa8\ub4c8 \uc7ac\ub8cc</span><hr>'+
makeResultHtmlByGroup(b.module);return a+'<hr></div><button type="button" class="hide-detailed-result" onclick="hideDetailedResult()" style="display: none">\uc138\ubd80 \uacb0\uacfc \uc228\uae30\uae30</button><hr style="border-top-color: #777; border-top-width: 3px;">'};var doNotRefreshResult=!1,showt=0,mshow=[];
const showResult=function(){if(!0!==doNotRefreshResult){showt=Date.now();var b=fetchInputData();mshow.push(Date.now()-showt);if(!1===b)return $("#result-container").html('<div id="result-guide"><hr class="main-line"><span class="result-maintitle" style="display: inline-block; width: 100%; text-align: left">\ud569\uacc4</span><br><br>\uc5ec\uae30\uc5d0 \uacb0\uacfc\uac00 \ud45c\uc2dc\ub429\ub2c8\ub2e4.</div>'),!1;showt=Date.now();b=calc(b);mshow.push(Date.now()-showt);showt=Date.now();sortResultData(b);
mshow.push(Date.now()-showt);showt=Date.now();b=tt(b);mshow.push(Date.now()-showt);showt=Date.now();document.getElementById("result-container").innerHTML=b;mshow.push(Date.now()-showt)}},fetchInputData=function(){var b={opIDs:[]},a=document.querySelectorAll('.op[name*="op_"]');if(0===a.length)return!1;for(var e=0,d=a.length;e<d;++e){var g=a[e],c=g.getAttribute("name").split("_")[1],l={},m={},h={},k={};null===db.op[c].elite?m=l=!1:(l.current=Number(g.querySelector(".current-elite").value),l.target=
Number(g.querySelector(".target-elite").value),m.current=Number(g.querySelector(".current-op-level").value),m.target=Number(g.querySelector(".target-op-level").value));if(null===db.op[c].skill)h=!1;else{var f=g.querySelectorAll(".current-skill-level"),n=g.querySelectorAll(".target-skill-level"),p=0;n.forEach(function(r){r.disabled||++p});if(0<p){var q=[];for(k=0;k<p;++k)q[k]={},q[k].current=Number(f[k].value),q[k].target=Number(n[k].value);h.common={};h.common.current=7<q[0].current?7:q[0].current;
h.common.target=7<q[0].target?7:q[0].target;h.mastery={};for(k=0;k<p;++k)h.mastery[k]={};for(k=0;k<p;++k)f=q[k].current-7,h.mastery[k].current=0<f?f:0,f=q[k].target-7,h.mastery[k].target=0<f?f:0;q=!0;h.common.current!=h.common.target&&(q=!1);if(q){for(k=0;k<p;++k)if(h.mastery[k].current!=h.mastery[k].target){q=!1;break}q&&(h=!1)}!1!==h&&0<=c.indexOf("-")&&(h.common.current=7)}else h=!1}k=null===db.op[c].module?!1:g.querySelector(".module-btn").classList.contains("selected");b.opIDs.push(c);b[c]={};
b[c].elite=l;b[c].opLevel=m;b[c].skillLevel=h;b[c].module=k}return b},sortResultData=function(b){const a=function(e,d){var g,c;e=db.item[e].name.kr;var l=db.item[d].name.kr;var m=d=c=g=-1;for(var h=0,k=itemOrder.length,f;h<k;++h)if(f=itemOrder[h].indexOf(e),0<=f){g=h;c=f;break}h=0;for(k=itemOrder.length;h<k;++h)if(f=itemOrder[h].indexOf(l),0<=f){d=h;m=f;break}-1!=g&&-1!=c||console.error(e,"\uc6b0\uc120\ub3c4 \uc624\ub958:",g,c);-1!=d&&-1!=m||console.error(l,"\uc6b0\uc120\ub3c4 \uc624\ub958:",d,m);
return g<d?-1:d<g?1:c<m?-1:1};b.skillLeveling.IDs.sort(a);b.elitePromotion.IDs.sort(a);b.total.IDs.sort(a);return b},getMaxLevel=function(b,a){return Number(db.oplv.maxLevel["elite_"+b][a-1])},levelingCalc=function(b){for(var a=db.oplv.leveling.expTable,e=db.oplv.leveling.lmdTable,d,g,c=g=d=0;c<b.target.elite;++c)d+=a["elite_"+String(c)][getMaxLevel(c,b.rarity)-1];d+=a["elite_"+String(b.target.elite)][b.target.level-1];d+=b.target.exp;for(c=0;c<b.target.elite;++c)g+=e["elite_"+String(c)][getMaxLevel(c,
b.rarity)-1];g+=e["elite_"+String(b.target.elite)][b.target.level-1];if(b.target.level<getMaxLevel(b.target.elite,b.rarity)){c=e["elite_"+String(b.target.elite)][b.target.level];c-=e["elite_"+String(b.target.elite)][b.target.level-1];var l=a["elite_"+String(b.target.elite)][b.target.level];l-=a["elite_"+String(b.target.elite)][b.target.level-1];g+=Math.ceil(c/l*b.target.exp)}var m,h;for(c=h=m=0;c<b.current.elite;++c)m+=a["elite_"+String(c)][getMaxLevel(c,b.rarity)-1];m+=a["elite_"+String(b.current.elite)][b.current.level-
1];m+=b.current.exp;for(c=0;c<b.current.elite;++c)h+=e["elite_"+String(c)][getMaxLevel(c,b.rarity)-1];h+=e["elite_"+String(b.current.elite)][b.current.level-1];b.current.level<getMaxLevel(b.current.elite,b.rarity)&&(c=e["elite_"+String(b.current.elite)][b.current.level],c-=e["elite_"+String(b.current.elite)][b.current.level-1],l=a["elite_"+String(b.current.elite)][b.current.level],l-=a["elite_"+String(b.current.elite)][b.current.level-1],h+=Math.ceil(c/l*b.current.exp));b={};b.exp=d-m;b.lmd=g-h;b.exp=
0>b.exp?0:b.exp;b.lmd=0>b.lmd?0:b.lmd;return b},calc=function(b){var a={opLeveling:{},skillLeveling:{},elitePromotion:{},module:{},total:{}};a.opLeveling.exp=0;for(var e=a.opLeveling.lmd=0;e<b.opIDs.length;++e){var d=b.opIDs[e];if(!1!==b[d].opLevel){var g={};g.rarity=db.op[d].rarity;g.current={};g.current.elite=b[d].elite.current;g.current.level=b[d].opLevel.current;g.current.exp=0;g.target={};g.target.elite=b[d].elite.target;g.target.level=b[d].opLevel.target;g.target.exp=0;d=levelingCalc(g);a.opLeveling.exp+=
d.exp;a.opLeveling.lmd+=d.lmd}}a.elitePromotion.IDs=[];e=0;for(g=b.opIDs.length;e<g;++e)if(d=b.opIDs[e],!1!==b[d].elite){var c=b[d].elite.current,l=b[d].elite.target;if(c!=l)for(;c<l;++c){var m=[];try{m=db.op[d].elite[c]}catch(q){console.error(q);console.error("opID:",d,db.op[d]);return}for(var h=0,k=m.length;h<k;++h){var f=m[h][0],n=Number(m[h][1]);a.elitePromotion.hasOwnProperty(f)?a.elitePromotion[f]+=n:(a.elitePromotion[f]=n,a.elitePromotion.IDs.push(f))}}}a.skillLeveling.IDs=[];e=0;for(g=b.opIDs.length;e<
g;++e)if(d=b.opIDs[e],!1!==b[d].skillLevel){l=Number(b[d].skillLevel.common.current);m=Number(b[d].skillLevel.common.target);for(c=l-1;c<m-1;++c){var p;(p=db.op[d].skill.common[c])||console.log(p,"\n",db.op[d],c,l,m);h=0;for(k=p.length;h<k;++h)f=p[h][0],n=Number(p[h][1]),a.skillLeveling.hasOwnProperty(f)?a.skillLeveling[f]+=n:(a.skillLeveling[f]=n,a.skillLeveling.IDs.push(f))}k=Object.keys(b[d].skillLevel.mastery).length;for(c=0;c<k;++c)for(l=Number(b[d].skillLevel.mastery[c].target),h=Number(b[d].skillLevel.mastery[c].current);h<
l;++h)for(m=db.op[d].skill.mastery[c][h],p=0;p<m.length;++p)f=m[p][0],n=Number(m[p][1]),a.skillLeveling.hasOwnProperty(f)?a.skillLeveling[f]+=n:(a.skillLeveling[f]=n,a.skillLeveling.IDs.push(f))}a.module.IDs=[];e=0;for(g=b.opIDs.length;e<g;++e)if(d=b.opIDs[e],!1!==b[d].module)for(c=0;c<db.op[d].module.length;++c)for(h=db.op[d].module[c],f=0;f<h.length;++f)k=h[f],n=k[0],k=k[1],a.module.hasOwnProperty(n)?a.module[n]+=k:(a.module[n]=k,a.module.IDs.push(n));a.total.exp=0;a.total.lmd=0;a.total.IDs=[];
a.total.exp+=a.opLeveling.exp;a.total.lmd+=a.opLeveling.lmd;for(e=0;e<a.elitePromotion.IDs.length;++e)f=a.elitePromotion.IDs[e],"\uc6a9\ubb38\ud3d0"==db.item[f].name.kr?a.total.lmd+=a.elitePromotion[f]:a.total.hasOwnProperty(f)?a.total[f]+=a.elitePromotion[f]:(a.total[f]=a.elitePromotion[f],a.total.IDs.push(f));for(e=0;e<a.skillLeveling.IDs.length;++e)f=a.skillLeveling.IDs[e],"\uc6a9\ubb38\ud3d0"==db.item[f].name.kr&&(a.total.lmd+=a.skillLeveling[f]),a.total.hasOwnProperty(f)?a.total[f]+=a.skillLeveling[f]:
(a.total[f]=a.skillLeveling[f],a.total.IDs.push(f));for(e=0;e<a.module.IDs.length;++e)f=a.module.IDs[e],"\uc6a9\ubb38\ud3d0"==db.item[f].name.kr?a.total.lmd+=a.module[f]:a.total.hasOwnProperty(f)?a.total[f]+=a.module[f]:(a.total[f]=a.module[f],a.total.IDs.push(f));return a};
