var gtag_breakdownUsed=!1;
const cutdownInput=function(a){var b=$(a);a=b.find(".item_body_have_input");b=b.find(".item_body_need_input");var d=a.val(),c=b.val(),e=Number(d),f=Number(c);e=isNaN(e)?0:e;f=isNaN(f)?0:f;e>f?(e-=f,f=0):(f-=e,e=0);f=0===f?"":f;a.val(0===e?"":e);b.val(f);d!=a.val()&&a.trigger("change");c!=b.val()&&b.trigger("change")},cutdownAllInputs=function(){gtag("event","\uc778\ubca4\ud1a0\ub9ac \uc785\ub825\uac12 \uc815\ub9ac",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"});var a=$(".item-container .item");
gtag_block=!0;for(var b=0;b<a.length;++b)cutdownInput(a.eq(b));gtag_block=!1},clearAllData=function(){confirm("\uc8fc\uc758: \uc774 \uc791\uc5c5\uc740 \ub418\ub3cc\ub9b4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\n\uc815\ub9d0\ub85c \ud574\ub2f9 \uc11c\ube44\uc2a4\uc640 \uad00\ub828\ub41c \ubaa8\ub4e0 \ub370\uc774\ud130\ub97c \ucd08\uae30\ud654\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?")&&(gtag("event","\ubaa8\ub4e0 \ub370\uc774\ud130 \ucd08\uae30\ud654",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"}),$(".item_body_have_input, .item_body_need_input").val(""),
clearStorageData(),location.reload())},clearInvNeed=function(){confirm("\uc8fc\uc758: \uc774 \uc791\uc5c5\uc740 \ub418\ub3cc\ub9b4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\n\uc815\ub9d0\ub85c \uc778\ubca4\ud1a0\ub9ac \ud0ed\uc758 \ud544\uc694\ub7c9\uc744 \ubaa8\ub450 \ucd08\uae30\ud654\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?")&&(gtag("event","\uc778\ubca4\ud1a0\ub9ac \ud0ed \ud544\uc694\ub7c9 \ucd08\uae30\ud654",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"}),$(".item_body_need_input").val(""),clearStorageNeedData(),
location.reload())},clearInvHave=function(){confirm("\uc8fc\uc758: \uc774 \uc791\uc5c5\uc740 \ub418\ub3cc\ub9b4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\n\uc815\ub9d0\ub85c \uc778\ubca4\ud1a0\ub9ac \ud0ed\uc758 \ubcf4\uc720\ub7c9\uc744 \ubaa8\ub450 \ucd08\uae30\ud654\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?")&&(gtag("event","\uc778\ubca4\ud1a0\ub9ac \ud0ed \ubcf4\uc720\ub7c9 \ucd08\uae30\ud654",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"}),$(".item_body_have_input").val(""),clearStorageHaveData(),location.reload())},
clearCalcData=function(){confirm("\uc8fc\uc758: \uc774 \uc791\uc5c5\uc740 \ub418\ub3cc\ub9b4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\n\uc815\ub9d0\ub85c \uacc4\uc0b0 \ud0ed\uc758 \ub370\uc774\ud130\ub97c \ubaa8\ub450 \ucd08\uae30\ud654\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n* \uc778\ubca4\ud1a0\ub9ac \ud0ed\uc758 \ub370\uc774\ud130\ub294 \ucd08\uae30\ud654\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")&&(gtag("event","\uacc4\uc0b0 \ud0ed \ub370\uc774\ud130 \uc815\ub9ac",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"}),
$(".item_body_craft_input").val(""),clearStorageCalcData(),location.reload())},toggleFilterOnlyLack=function(){gtag("event","\ubd80\uc871\ud55c \uc544\uc774\ud15c\ub9cc \ud45c\uc2dc \uae30\ub2a5 \ud1a0\uae00",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"});filterOnlyLack=!filterOnlyLack;localStorage.setItem("mcalc_filter_onlyLack",JSON.stringify(filterOnlyLack));refreshBtnFilterOnlyLack();applyConfig()},refreshBtnFilterOnlyLack=function(){for(var a=$('[name="toggleFilterOnlyLack"]'),b=0;b<
a.length;++b)filterOnlyLack?a.eq(b).html('\ubd80\uc871\ud55c \uc544\uc774\ud15c\ub9cc \ud45c\uc2dc <span style="color:#187dc9">ON</span>'):a.eq(b).html('\ubd80\uc871\ud55c \uc544\uc774\ud15c\ub9cc \ud45c\uc2dc <span style="color:#de0d0d">OFF</span>')},checkBreakdownValue=function(a){0===Number(a.value)&&(clearStorageCalcData(),refreshAllCalcItems(),fetchConfig(),applyConfig())},applyConfig=function(){var a=$(".item-container");a.find('[class*="category_"]').css("display","block");var b=a.find(".item");
b.css("display","inline-block");for(var d=0;d<filterCategory.length;++d)a.find(".category_"+filterCategory[d]).css("display","none");for(d=0;d<filterGrade.length;++d)for(var c=0;c<b.length;++c){var e=Number(b.eq(c).attr("id").split("_")[1]);db.item[e].grade==filterGrade[d]&&b.eq(c).css("display","none")}0<breakdownGrade&&"none"!==document.querySelector(".calc").style.display?(console.log("breakdown"),document.querySelector(".calc").classList.add("auto-breakdown"),breakdownByGrade(breakdownGrade)):
document.querySelector(".calc").classList.remove("auto-breakdown");if(filterOnlyLack)for(d=0;d<b.length;++d)0<=Number(b.eq(d).find(".item_thumb_quantity").text())&&b.eq(d).css("display","none");displayName?a.find(".item_thumb_name").css("display","inline-block"):a.find(".item_thumb_name").css("display","none");displayInputField?a.find(".item_body_have, .item_body_need, .item_body_craft").css("display","inline-block"):a.find(".item_body_have, .item_body_need, .item_body_craft").css("display","none");
displayGuide?$(".guide").css("display","inline-block"):$(".guide").css("display","none")},hideGuide=function(){displayGuide=!1;localStorage.setItem("mcalc_display_guide",JSON.stringify(displayGuide));applyConfig()},setSurplus=function(a,b){a=a.querySelector(".item_thumb_quantity");a.innerText=b;a=a.classList;0>b?(a.add("minus"),a.remove("plus")):(0<b?a.add("plus"):a.remove("plus"),a.remove("minus"))},getSurplus=function(a){var b=getItem_need(a),d=getItem_have(a),c=getItem_craft(a);a=getItem_totalDemand(a);
return d+c-(b+a)},refreshDemand=function(a,b){var d=db.item[a].craft[0];if(void 0!==d){var c=getItem_craft(a);if(b){b=0;for(var e=d.length;b<e;++b){var f=d[b][0];setItem_demand(f,a,d[b][1]*c);$(document.getElementById("calc-item_"+f)).trigger("refresh")}}else for(b=0,e=d.length;b<e;++b)setItem_demand(d[b][0],a,d[b][1]*c)}},refreshAllCalcItems=function(){for(var a=document.querySelectorAll(".calc .item"),b=[],d=[],c=0,e=a.length;c<e;++c)b.push(a[c].getAttribute("id").split("_")[1]),d.push(a[c].querySelector("input"));
c=0;for(e=a.length;c<e;++c)d[c]&&(d[c].value=getItem_craft(b[c]),refreshDemand(b[c],!1));c=0;for(e=a.length;c<e;++c)setSurplus(a[c],getSurplus(b[c]))},breakdownByGrade=function(a){gtag_breakdownUsed||(gtag_breakdownUsed=!0,gtag("event","\uc790\ub3d9 \ubd84\ud574 \ucd5c\ucd08 \uc0ac\uc6a9",{event_category:"\uc7ac\ub8cc \uacc4\uc0b0\uae30 2.0"}));clearStorageCalcData();var b=[];for(a+=1;5>=a;++a)b.push(...document.querySelectorAll(".calc .item.grade_"+a+":not(.uncraftable)"));var d=[];a=0;for(var c=
b.length;a<c;++a)d.push(b[a].getAttribute("id").split("_")[1]);a=0;for(c=b.length;a<c;++a)6<=d[a]&&8>=d[a]&&(d.splice(a,1),b.splice(a,1),--c,--a);for(var e;;){e=!0;a=0;for(c=b.length;a<c;++a){var f=d[a],g=getSurplus(f),h=getItem_craft(f);if(!(0===g||0<g&&0===h)){e=!1;break}}if(e)break;a=0;for(c=b.length;a<c;++a)f=d[a],h=getItem_craft(f),g=getSurplus(f),setItem_craft(f,h<g?0:h-g),refreshDemand(f,!1)}refreshAllCalcItems()};
